
<mat-card>
  <app-card-header
    title="Tipos de documento"
    [description]="'Listado de tipos de documento habilitados.'">
  </app-card-header>

  <mat-card-content>
    <ng-container *ngIf="!loading && !errorMsg; else estado">
      <!-- Tabla personalizada para tipos de documento -->
      <div class="table-container">
        <table class="custom-table">
          <thead>
            <tr>
              <th>Tipo de documento</th>
              <th>Abreviatura</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let tipo of tipos">
              <td>{{ tipo.name }}</td>
              <td>{{ tipo.abbreviation }}</td>
              <td class="actions-cell">
                <button
                  class="btn btn-sm btn-success"
                  (click)="abrirFormularioActualizar(tipo)"
                  title="Editar tipo de documento">
                  Editar
                </button>
                <button
                  class="btn btn-sm btn-success-dark ml-2"
                  (click)="confirmarEliminacion(tipo)"
                  title="Eliminar tipo de documento">
                  Eliminar
                </button>
              </td>
            </tr>
            <tr *ngIf="tipos.length === 0">
              <td colspan="3" class="text-center">No hay tipos de documento para mostrar</td>
            </tr>
          </tbody>
        </table>
      </div>
    </ng-container>

    <ng-template #estado>
      <div *ngIf="loading">Cargando tipos de documento...</div>
      <div *ngIf="!loading && errorMsg" class="text-red-600">{{ errorMsg }}</div>
    </ng-template>
  </mat-card-content>

  <app-button
    texto="Agregar nuevo tipo de documento"
    color="accent"
    (clicked)="abrirFormulario()">
  </app-button>
</mat-card>

<!-- Mensajes de éxito y error -->
<div *ngIf="successMsg" class="alert alert-success">
  {{ successMsg }}
</div>

<div *ngIf="errorMsg" class="alert alert-error">
  {{ errorMsg }}
</div>

<!-- Modal para crear tipo de documento -->
<div *ngIf="showForm" class="modal-overlay" (click)="cerrarFormulario()">
  <div class="modal-content modern-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-content">
        <div class="header-icon create-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="header-text">
          <h3>Crear Nuevo Tipo de Documento</h3>
          <p>Ingresa la información del nuevo tipo de documento</p>
        </div>
      </div>
      <button class="close-btn" (click)="cerrarFormulario()">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <form [formGroup]="documentTypeForm" (ngSubmit)="crearDocumentTypeDto()">
        <div class="form-grid">
          <div class="form-group">
            <label for="name">
              <svg class="input-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M2 3H14V13H2V3Z" stroke="currentColor" stroke-width="1.5" fill="none"/>
                <path d="M5 6H11M5 8H11M5 10H8" stroke="currentColor" stroke-width="1.5"/>
              </svg>
              Nombre del Tipo de Documento
            </label>
            <input
              type="text"
              id="name"
              formControlName="name"
              class="form-control modern-input"
              [class.is-invalid]="isFieldInvalid('name')"
              placeholder="Ej: Cédula de Ciudadanía">
            <div *ngIf="isFieldInvalid('name')" class="invalid-feedback">
              {{ getFieldError('name') }}
            </div>
          </div>

          <div class="form-group">
            <label for="abbreviation">
              <svg class="input-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M8 8C10.2091 8 12 6.20914 12 4C12 1.79086 10.2091 0 8 0C5.79086 0 4 1.79086 4 4C4 6.20914 5.79086 8 8 8Z" fill="currentColor"/>
                <path d="M8 10C3.58172 10 0 12.6863 0 16H16C16 12.6863 12.4183 10 8 10Z" fill="currentColor"/>
              </svg>
              Abreviatura
            </label>
            <input
              type="text"
              id="abbreviation"
              formControlName="abbreviation"
              class="form-control modern-input"
              [class.is-invalid]="isFieldInvalid('abbreviation')"
              placeholder="Ej: CC">
            <div *ngIf="isFieldInvalid('abbreviation')" class="invalid-feedback">
              {{ getFieldError('abbreviation') }}
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary modern-btn" (click)="cerrarFormulario()">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
            Cancelar
          </button>
          <button type="submit" class="btn btn-primary modern-btn" [disabled]="loading || documentTypeForm.invalid">
            <svg *ngIf="!loading" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M13 4L6 11L3 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <div *ngIf="loading" class="loading-spinner"></div>
            <span *ngIf="loading">Creando...</span>
            <span *ngIf="!loading">Crear Tipo de Documento</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal para actualizar tipo de documento -->
<div *ngIf="showUpdateForm" class="modal-overlay" (click)="cerrarFormularioActualizar()">
  <div class="modal-content modern-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-content">
        <div class="header-icon edit-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="header-text">
          <h3>Actualizar Tipo de Documento</h3>
          <p>Modifica la información del tipo de documento</p>
        </div>
      </div>
      <button class="close-btn" (click)="cerrarFormularioActualizar()">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <form [formGroup]="updateForm" (ngSubmit)="actualizarDocumentTypeDto()">
        <div class="form-grid">
          <div class="form-group">
            <label for="update-name">
              <svg class="input-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M2 3H14V13H2V3Z" stroke="currentColor" stroke-width="1.5" fill="none"/>
                <path d="M5 6H11M5 8H11M5 10H8" stroke="currentColor" stroke-width="1.5"/>
              </svg>
              Nombre del Tipo de Documento
            </label>
            <input
              type="text"
              id="update-name"
              formControlName="name"
              class="form-control modern-input"
              [class.is-invalid]="isFieldInvalid('name', updateForm)"
              placeholder="Ej: Cédula de Ciudadanía">
            <div *ngIf="isFieldInvalid('name', updateForm)" class="invalid-feedback">
              {{ getFieldError('name', updateForm) }}
            </div>
          </div>

          <div class="form-group">
            <label for="update-abbreviation">
              <svg class="input-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M8 8C10.2091 8 12 6.20914 12 4C12 1.79086 10.2091 0 8 0C5.79086 0 4 1.79086 4 4C4 6.20914 5.79086 8 8 8Z" fill="currentColor"/>
                <path d="M8 10C3.58172 10 0 12.6863 0 16H16C16 12.6863 12.4183 10 8 10Z" fill="currentColor"/>
              </svg>
              Abreviatura
            </label>
            <input
              type="text"
              id="update-abbreviation"
              formControlName="abbreviation"
              class="form-control modern-input"
              [class.is-invalid]="isFieldInvalid('abbreviation', updateForm)"
              placeholder="Ej: CC">
            <div *ngIf="isFieldInvalid('abbreviation', updateForm)" class="invalid-feedback">
              {{ getFieldError('abbreviation', updateForm) }}
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary modern-btn" (click)="cerrarFormularioActualizar()">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
            Cancelar
          </button>
          <button type="submit" class="btn btn-primary modern-btn" [disabled]="loading || updateForm.invalid">
            <svg *ngIf="!loading" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M13 4L6 11L3 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <div *ngIf="loading" class="loading-spinner"></div>
            <span *ngIf="loading">Actualizando...</span>
            <span *ngIf="!loading">Actualizar Tipo de Documento</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal de confirmación para eliminar -->
<div *ngIf="showConfirm" class="modal-overlay">
  <div class="modal-content modal-sm">
    <div class="modal-header">
      <h3>Confirmar Eliminación</h3>
    </div>

    <div class="modal-body">
      <p>¿Está seguro que desea eliminar el tipo de documento <strong>{{ documentTypeAEliminar?.name }}</strong>?</p>
      <p class="text-warning">Esta acción no se puede deshacer.</p>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="cancelarEliminacion()">
        Cancelar
      </button>
      <button type="button" class="btn btn-danger" (click)="eliminarDocumentTypeDto()" [disabled]="loading">
        <span *ngIf="loading">Eliminando...</span>
        <span *ngIf="!loading">Eliminar</span>
      </button>
    </div>
  </div>
</div>
