<!-- <app-topbar></app-topbar> -->

<mat-card>
  <app-card-header
    title="Valores "
    [description]="'Listado de valores SMLDV con su salario mínimo correspondiente.'">
  </app-card-header>

  <mat-card-content>
    <ng-container *ngIf="!loading && !errorMsg; else estado">
      <!-- Tabla personalizada para SMLDV -->
      <div class="table-container">
        <table class="custom-table">
          <thead>
            <tr>
              <th>Valor SMLDV</th>
              <th>Año Vigente</th>
              <th>Salario Mínimo</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let smdlv of paginatedSmdlv">
              <td>{{ smdlv.value_smldv | currency:'COP':'symbol':'1.0-0' }}</td>
              <td>{{ smdlv.current_Year }}</td>
              <td>{{ smdlv.minimunWage | currency:'COP':'symbol':'1.0-0' }}</td>
              <td class="actions-cell">
                <button
                  class="btn btn-sm btn-success"
                  (click)="confirmarActualizacion(smdlv)"
                  title="Editar valor SMLDV">
                  Editar
                </button>
                <button
                  class="btn btn-sm btn-success-dark ml-2"
                  (click)="confirmarEliminacion(smdlv)"
                  title="Eliminar valor SMLDV">
                  Eliminar
                </button>
              </td>
            </tr>
            <tr *ngIf="paginatedSmdlv.length === 0 && !loading">
              <td colspan="4" class="text-center">No hay valores SMLDV para mostrar</td>
            </tr>
          </tbody>
        </table>

        <!-- Paginación -->
        <div class="pagination-container" *ngIf="totalPages > 1">
          <div class="pagination-info">
            <span>Página {{ currentPage }} de {{ totalPages }} ({{ smdlvs.length }} elementos)</span>
          </div>
          <div class="pagination-controls">
            <button
              class="pagination-btn"
              (click)="prevPage()"
              [disabled]="currentPage === 1"
              title="Página anterior">
              « Anterior
            </button>

            <button
              *ngFor="let page of getVisiblePages()"
              class="pagination-btn"
              [class.active]="page === currentPage"
              (click)="goToPage(page)">
              {{ page }}
            </button>

            <button
              class="pagination-btn"
              (click)="nextPage()"
              [disabled]="currentPage === totalPages"
              title="Página siguiente">
              Siguiente »
            </button>
          </div>
        </div>
      </div>
    </ng-container>

    <ng-template #estado>
      <div *ngIf="loading">Cargando valores SMLDV...</div>
      <div *ngIf="!loading && errorMsg" class="text-red-600">{{ errorMsg }}</div>
    </ng-template>
  </mat-card-content>

 <app-button
   *ngIf="mostrarBotonCrear()"
   texto="Agregar nuevo valor SMLDV"
   color="accent"
   (clicked)="abrirFormulario()">
 </app-button>
</mat-card>

<!-- Mensajes de éxito y error -->
<div *ngIf="successMsg" class="alert alert-success">
  {{ successMsg }}
</div>

<div *ngIf="errorMsg" class="alert alert-error">
  {{ errorMsg }}
</div>

<!-- Modal para crear valor SMLDV -->
<div *ngIf="showForm" class="modal-overlay" (click)="cerrarFormulario()">
  <div class="modal-content modern-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-content">
        <div class="header-icon create-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="header-text">
          <h3>Crear Nuevo Valor SMLDV</h3>
          <p>Ingresa la información del nuevo valor SMLDV</p>
        </div>
      </div>
      <button class="close-btn" (click)="cerrarFormulario()">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <form [formGroup]="smdlvForm" (ngSubmit)="crearSmdlv()">
        <div class="form-grid">
          <div class="form-group">
            <label for="value_smldv">
              <svg class="input-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M2 3H14V13H2V3Z" stroke="currentColor" stroke-width="1.5" fill="none"/>
                <path d="M5 6H11M5 8H11M5 10H8" stroke="currentColor" stroke-width="1.5"/>
              </svg>
              Valor SMLDV (Calculado automáticamente)
            </label>
            <input
              type="number"
              id="value_smldv"
              [value]="smdlvForm.get('minimunWage')?.value ? (smdlvForm.get('minimunWage')?.value * 30) : 0"
              class="form-control modern-input"
              readonly
              placeholder="Se calcula automáticamente">
            <small class="text-muted">Valor calculado como: Salario Mínimo ÷ 30</small>
          </div>

          <div class="form-group">
            <label for="current_Year">
              <svg class="input-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M8 1L14 4V12L8 15L2 12V4L8 1Z" stroke="currentColor" stroke-width="1.5" fill="none"/>
              </svg>
              Año Vigente
            </label>
            <input
              type="number"
              id="current_Year"
              formControlName="current_Year"
              class="form-control modern-input"
              [class.is-invalid]="isFieldInvalid('current_Year')"
              placeholder="Ej: 2024"
              min="1900"
              max="2100">
            <div *ngIf="isFieldInvalid('current_Year')" class="invalid-feedback">
              {{ getFieldError('current_Year') }}
            </div>
          </div>

          <div class="form-group">
            <label for="minimunWage">
              <svg class="input-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M2 3H14V13H2V3Z" stroke="currentColor" stroke-width="1.5" fill="none"/>
                <path d="M5 6H11M5 8H11M5 10H8" stroke="currentColor" stroke-width="1.5"/>
              </svg>
              Salario Mínimo
            </label>
            <input
              type="number"
              id="minimunWage"
              formControlName="minimunWage"
              class="form-control modern-input"
              [class.is-invalid]="isFieldInvalid('minimunWage')"
              placeholder="Ej: 1160000"
              min="0">
            <div *ngIf="isFieldInvalid('minimunWage')" class="invalid-feedback">
              {{ getFieldError('minimunWage') }}
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary modern-btn" (click)="cerrarFormulario()">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
            Cancelar
          </button>
          <button type="submit" class="btn btn-primary modern-btn" [disabled]="loading || smdlvForm.invalid">
            <svg *ngIf="!loading" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M13 4L6 11L3 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <div *ngIf="loading" class="loading-spinner"></div>
            <span *ngIf="loading">Creando...</span>
            <span *ngIf="!loading">Crear Valor SMLDV</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal para actualizar valor SMLDV -->
<div *ngIf="showUpdateForm" class="modal-overlay" (click)="cerrarFormularioActualizar()">
  <div class="modal-content modern-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-content">
        <div class="header-icon edit-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="header-text">
          <h3>Actualizar Valor SMLDV</h3>
          <p>Modifica la información del valor SMLDV</p>
        </div>
      </div>
      <button class="close-btn" (click)="cerrarFormularioActualizar()">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <form [formGroup]="updateForm" (ngSubmit)="actualizarSmdlv()">
        <div class="form-grid">
          <div class="form-group">
            <label for="update-value_smldv">
              <svg class="input-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M2 3H14V13H2V3Z" stroke="currentColor" stroke-width="1.5" fill="none"/>
                <path d="M5 6H11M5 8H11M5 10H8" stroke="currentColor" stroke-width="1.5"/>
              </svg>
              Valor SMLDV (Calculado automáticamente)
            </label>
            <input
              type="number"
              id="update-value_smldv"
              [value]="updateForm.get('minimunWage')?.value ? (updateForm.get('minimunWage')?.value * 30) : 0"
              class="form-control modern-input"
              readonly
              placeholder="Se calcula automáticamente">
            <small class="text-muted">Valor calculado como: Salario Mínimo ÷ 30</small>
          </div>

          <div class="form-group">
            <label for="update-current_Year">
              <svg class="input-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M8 1L14 4V12L8 15L2 12V4L8 1Z" stroke="currentColor" stroke-width="1.5" fill="none"/>
              </svg>
              Año Vigente
            </label>
            <input
              type="number"
              id="update-current_Year"
              formControlName="current_Year"
              class="form-control modern-input"
              [class.is-invalid]="isFieldInvalid('current_Year', updateForm)"
              placeholder="Ej: 2024"
              min="1900"
              max="2100">
            <div *ngIf="isFieldInvalid('current_Year', updateForm)" class="invalid-feedback">
              {{ getFieldError('current_Year', updateForm) }}
            </div>
          </div>

          <div class="form-group">
            <label for="update-minimunWage">
              <svg class="input-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M2 3H14V13H2V3Z" stroke="currentColor" stroke-width="1.5" fill="none"/>
                <path d="M5 6H11M5 8H11M5 10H8" stroke="currentColor" stroke-width="1.5"/>
              </svg>
              Salario Mínimo
            </label>
            <input
              type="number"
              id="update-minimunWage"
              formControlName="minimunWage"
              class="form-control modern-input"
              [class.is-invalid]="isFieldInvalid('minimunWage', updateForm)"
              placeholder="Ej: 1160000"
              min="0">
            <div *ngIf="isFieldInvalid('minimunWage', updateForm)" class="invalid-feedback">
              {{ getFieldError('minimunWage', updateForm) }}
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary modern-btn" (click)="cerrarFormularioActualizar()">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
            Cancelar
          </button>
          <button type="submit" class="btn btn-primary modern-btn" [disabled]="loading">
            <svg *ngIf="!loading" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M13 4L6 11L3 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <div *ngIf="loading" class="loading-spinner"></div>
            <span *ngIf="loading">Actualizando...</span>
            <span *ngIf="!loading">Actualizar Valor SMLDV</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal de confirmación para eliminar -->
<div *ngIf="showConfirm" class="modal-overlay">
  <div class="modal-content modal-sm">
    <div class="modal-header">
      <h3>Confirmar Eliminación</h3>
    </div>

    <div class="modal-body">
      <div class="warning-content">
        <div class="warning-icon">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 9V13M12 17H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="#EF4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="warning-text">
          <h4>¿Está seguro que desea eliminar?</h4>
          <p>Va a eliminar permanentemente el valor SMLDV del año <strong>"{{ smdlvAEliminar?.current_Year }}"</strong></p>
          <p class="text-warning"><strong>⚠️ Esta acción no se puede deshacer.</strong></p>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="cancelarEliminacion()">
        Cancelar
      </button>
      <button type="button" class="btn btn-danger" (click)="eliminarSmdlv()" [disabled]="loading">
        <span *ngIf="loading">Eliminando...</span>
        <span *ngIf="!loading">Eliminar</span>
      </button>
    </div>
  </div>
</div>

<!-- Modal de confirmación para actualizar -->
<div *ngIf="showUpdateConfirm" class="modal-overlay">
  <div class="modal-content modal-sm">
    <div class="modal-header">
      <h3>Confirmar Actualización</h3>
    </div>

    <div class="modal-body">
      <div class="warning-content">
        <div class="warning-icon">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="#3B82F6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z" stroke="#3B82F6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="warning-text">
          <h4>¿Desea actualizar este valor SMLDV?</h4>
          <p>Va a editar la información del valor SMLDV del año <strong>"{{ smdlvAActualizar?.current_Year }}"</strong></p>
          <p class="text-info"><strong>📝 Se abrirá el formulario de edición.</strong></p>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="cancelarActualizacion()">
        Cancelar
      </button>
      <button type="button" class="btn btn-primary" (click)="abrirFormularioActualizar()">
        Sí, Editar
      </button>
    </div>
  </div>
</div>
