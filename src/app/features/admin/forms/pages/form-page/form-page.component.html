<div class="personas-container">
  <h1 class="page-title">Gesti√≥n de Formularios</h1>

  <!-- Bot√≥n para agregar nuevo formulario -->
  <button 
    (click)="abrirModal()" 
    class="btn-agregar"
    aria-label="Abrir modal para agregar nuevo formulario"
    title="Agregar nuevo formulario">
    <i class="pi pi-plus" aria-hidden="true"></i>
    Agregar Formulario
  </button>

  <!-- Lista de formularios -->
  <section aria-label="Lista de formularios">
    <div 
      *ngFor="let form of paginatedForms; trackBy: trackByFormId" 
      class="persona-card"
      role="article"
      [attr.aria-label]="'Formulario: ' + form.name">
      <div class="persona-info">
        <div class="info-row">
          <span class="label" [id]="'name-label-' + form.id">Nombre:</span>
          <span class="value" [attr.aria-labelledby]="'name-label-' + form.id">{{ form.name }}</span>
        </div>
        <div class="info-row">
          <span class="label" [id]="'desc-label-' + form.id">Descripci√≥n:</span>
          <span class="value" [attr.aria-labelledby]="'desc-label-' + form.id">{{ form.description }}</span>
        </div>
      </div>
      <div class="persona-actions" role="group" [attr.aria-label]="'Acciones para ' + form.name">
        <button 
          (click)="confirmarActualizacion(form)" 
          class="btn-editar"
          [attr.aria-label]="'Editar formulario ' + form.name"
          [title]="'Editar ' + form.name">
          <i class="pi pi-pencil" aria-hidden="true"></i>
          Editar
        </button>
        <button 
          (click)="pedirConfirmacionEliminar(form)" 
          class="btn-eliminar"
          [attr.aria-label]="'Eliminar formulario ' + form.name"
          [title]="'Eliminar ' + form.name">
          <i class="pi pi-trash" aria-hidden="true"></i>
          Eliminar
        </button>
      </div>
    </div>
  </section>

  <!-- Mensaje cuando no hay datos -->
  <div *ngIf="forms.length === 0" class="no-data">
    <i class="pi pi-info-circle"></i>
    <p>No hay formularios registrados</p>
    <small>Haga clic en "Agregar Formulario" para comenzar</small>
  </div>

  <!-- Paginaci√≥n -->
  <app-pagination
    [currentPage]="paginationConfig.currentPage"
    [totalPages]="paginationConfig.totalPages"
    [totalItems]="paginationConfig.totalItems"
    [itemsPerPage]="paginationConfig.itemsPerPage"
    (pageChange)="onPageChange($event)">
  </app-pagination>
</div>

<!-- ========================================
     MODALES GLOBALES (FUERA DEL CONTENEDOR)
     ======================================== -->

<!-- Modal de alerta (√©xito, error, info) -->
<div *ngIf="showAlert" class="alert-modal-overlay">
  <div class="alert-modal-content" [ngClass]="alertType">
    <span class="alert-icon" *ngIf="alertType === 'creado'">‚úÖ</span>
    <span class="alert-icon" *ngIf="alertType === 'eliminado'">üóëÔ∏è</span>
    <span class="alert-icon" *ngIf="alertType === 'error'">‚ùå</span>
    <span class="alert-icon" *ngIf="alertType === 'info'">‚ÑπÔ∏è</span>
    <span class="alert-msg">{{ alertMsg }}</span>
  </div>
</div>

<!-- Modal de confirmaci√≥n de eliminaci√≥n -->
<div *ngIf="showConfirm" class="alert-modal-overlay">
  <div class="alert-modal-content eliminado">
    <span class="alert-icon">üóëÔ∏è</span>
    <span class="alert-msg">¬øEst√°s seguro de que deseas eliminar este formulario?</span>
    <div class="modal-actions">
      <button class="blue-btn" (click)="cancelarEliminar()">Cancelar</button>
      <button class="red-btn" (click)="confirmarEliminar()">Eliminar</button>
    </div>
  </div>
</div>

<!-- Modal de confirmaci√≥n para actualizar -->
<div *ngIf="showUpdateConfirm" class="alert-modal-overlay">
  <div class="alert-modal-content eliminado">
    <span class="alert-icon">‚úèÔ∏è</span>
    <span class="alert-msg">¬øEst√° seguro que desea actualizar el formulario "{{ formAActualizar?.name }}"?</span>
    <div class="modal-actions">
      <button class="blue-btn" (click)="cancelarActualizacion()">Cancelar</button>
      <button class="blue-btn" (click)="abrirModalActualizar()">S√≠, Editar</button>
    </div>
  </div>
</div>

<!-- Modal para crear nuevo formulario -->
<div *ngIf="showModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="create-modal-title">
  <div class="modal-content persona-form">
    <h2 id="create-modal-title">Agregar Nuevo Formulario</h2>
    <form (ngSubmit)="crearForm()" autocomplete="off" #createForm="ngForm" novalidate>
      <label for="create-name-input">
        Nombre del Formulario:
        <input 
          id="create-name-input"
          type="text" 
          [(ngModel)]="nuevoForm.name" 
          name="name" 
          required
          #nameInput="ngModel" 
          maxlength="100" 
          placeholder="Ej: Formulario de acuerdo de pago"
          aria-describedby="create-name-error"
          [attr.aria-invalid]="nameInput.invalid && nameInput.touched" />
        <div 
          id="create-name-error"
          *ngIf="nameInput.invalid && nameInput.touched" 
          class="error-msg"
          role="alert"
          aria-live="polite">
          El nombre es requerido
        </div>
      </label>
      <label for="create-desc-input">
        Descripci√≥n:
        <textarea 
          id="create-desc-input"
          [(ngModel)]="nuevoForm.description" 
          name="description" 
          required
          #descriptionInput="ngModel" 
          maxlength="300" 
          rows="4"
          placeholder="Describe el prop√≥sito y uso del formulario..."
          aria-describedby="create-desc-error"
          [attr.aria-invalid]="descriptionInput.invalid && descriptionInput.touched"></textarea>
        <div 
          id="create-desc-error"
          *ngIf="descriptionInput.invalid && descriptionInput.touched" 
          class="error-msg"
          role="alert"
          aria-live="polite">
          La descripci√≥n es requerida
        </div>
      </label>
      <div class="modal-actions">
        <button 
          type="button" 
          (click)="cerrarModal()"
          aria-label="Cancelar creaci√≥n del formulario">
          Cancelar
        </button>
        <button 
          type="submit" 
          [disabled]="createForm.invalid || !nuevoForm.name.trim() || !nuevoForm.description.trim()"
          aria-label="Crear nuevo formulario">
          Crear
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal para actualizar formulario -->
<div *ngIf="showUpdateModal && formSeleccionado" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="update-modal-title">
  <div class="modal-content persona-form">
    <h2 id="update-modal-title">Actualizar Formulario</h2>
    <form (ngSubmit)="actualizarForm()" autocomplete="off" #updateForm="ngForm" novalidate>
      <label for="update-name-input">
        Nombre del Formulario:
        <input
          id="update-name-input"
          type="text"
          [(ngModel)]="formSeleccionado.name"
          name="name"
          required
          #nameUpdateInput="ngModel"
          maxlength="100"
          placeholder="Ej: Formulario de acuerdo de pago"
          aria-describedby="update-name-error"
          [attr.aria-invalid]="nameUpdateInput.invalid && nameUpdateInput.touched" />
        <div
          id="update-name-error"
          *ngIf="nameUpdateInput.invalid && nameUpdateInput.touched"
          class="error-msg"
          role="alert"
          aria-live="polite">
          El nombre es requerido
        </div>
      </label>
      <label for="update-desc-input">
        Descripci√≥n:
        <textarea
          id="update-desc-input"
          [(ngModel)]="formSeleccionado.description"
          name="description"
          required
          #descriptionUpdateInput="ngModel"
          maxlength="300"
          rows="4"
          placeholder="Describe el prop√≥sito y uso del formulario..."
          aria-describedby="update-desc-error"
          [attr.aria-invalid]="descriptionUpdateInput.invalid && descriptionUpdateInput.touched"></textarea>
        <div
          id="update-desc-error"
          *ngIf="descriptionUpdateInput.invalid && descriptionUpdateInput.touched"
          class="error-msg"
          role="alert"
          aria-live="polite">
          La descripci√≥n es requerida
        </div>
      </label>
      <div class="modal-actions">
        <button
          type="button"
          (click)="cerrarModalActualizar()"
          aria-label="Cancelar actualizaci√≥n del formulario">
          Cancelar
        </button>
        <button
          type="submit"
          [disabled]="updateForm.invalid || !formSeleccionado.name.trim() || !formSeleccionado.description.trim()"
          aria-label="Actualizar formulario">
          Actualizar
        </button>
      </div>
    </form>
  </div>
</div>